!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("case"),require("base64-js"),require("google-protobuf")):"function"==typeof define&&define.amd?define(["exports","case","base64-js","google-protobuf"],r):r((e=e||self)["impresso-jscommons"]=e["impresso-jscommons"]||{},e.case,e["base64-js"],e.goog)}(this,(function(e,r,t,o){"use strict";function i(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function n(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?s(Object(t),!0).forEach((function(r){i(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function a(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var t=[],o=!0,i=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(t.push(n.value),!r||t.length!==r);o=!0);}catch(e){i=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(i)throw s}}return t}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(e){return function(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}r=r&&r.hasOwnProperty("default")?r.default:r,t=t&&t.hasOwnProperty("default")?t.default:t,o=o&&o.hasOwnProperty("default")?o.default:o;var p=r.snake,l=r.camel,c=r.upper,y=r.pascal,f=t.fromByteArray,d=t.toByteArray;function g(e,r){if(void 0!==r){var t=new e;return Object.keys(r).forEach((function(e){var o="set".concat(y(e)),i="set".concat(y(e),"List"),s=t[o]||t[i];if(void 0===s)throw new Error('Unknown property: "'.concat(e,'"'));s.call(t,r[e])})),t}}function m(e){return Object.keys(e).reduce((function(e,r){return r.endsWith("List")&&(e[r.replace(/List$/,"")]=e[r].map(m),delete e[r]),e}),e)}var E=g,F=function(e){return Object.keys(e).reduce((function(e,r){return(void 0===e[r]||Array.isArray(e[r])&&0===e[r].length)&&delete e[r],e}),e)},h=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r&&0!==r){var o=Object.keys(e).find((function(t){return e[t]===r}));if(!o)throw new Error("Unknown enum number: ".concat(r));var i=l(o.split("_").slice(1).join("_"));return t?c(i):i}},T=function(e,r){if(void 0!==r){var t=[Object.keys(e)[0].split("_")[0],c(p(r),"_")].join("_"),o=e[t];if(void 0===o)throw new Error("Unknown enum value: ".concat(r," (").concat(t,")"));return o}},q=function(e,r,t){if(void 0!==r){var o=t?t(r):r;return f(g(e,o).serializeBinary())}},O=function(e,r,t){var o=m(e.deserializeBinary(d(r)).toObject());return t?t(o):o};var b=function(e,r){return e(r={exports:{}},r.exports),r.exports}((function(e,r){var t=o,i=Function("return this")();t.exportSymbol("proto.impresso.query.DateRange",null,i),t.exportSymbol("proto.impresso.query.Filter",null,i),t.exportSymbol("proto.impresso.query.FilterContext",null,i),t.exportSymbol("proto.impresso.query.FilterOperator",null,i),t.exportSymbol("proto.impresso.query.FilterPrecision",null,i),t.exportSymbol("proto.impresso.query.FilterType",null,i),t.exportSymbol("proto.impresso.query.GroupValue",null,i),t.exportSymbol("proto.impresso.query.SearchQuery",null,i),proto.impresso.query.DateRange=function(e){o.Message.initialize(this,e,0,-1,null,null)},t.inherits(proto.impresso.query.DateRange,o.Message),t.DEBUG&&!COMPILED&&(proto.impresso.query.DateRange.displayName="proto.impresso.query.DateRange"),proto.impresso.query.Filter=function(e){o.Message.initialize(this,e,0,-1,proto.impresso.query.Filter.repeatedFields_,null)},t.inherits(proto.impresso.query.Filter,o.Message),t.DEBUG&&!COMPILED&&(proto.impresso.query.Filter.displayName="proto.impresso.query.Filter"),proto.impresso.query.SearchQuery=function(e){o.Message.initialize(this,e,0,-1,proto.impresso.query.SearchQuery.repeatedFields_,null)},t.inherits(proto.impresso.query.SearchQuery,o.Message),t.DEBUG&&!COMPILED&&(proto.impresso.query.SearchQuery.displayName="proto.impresso.query.SearchQuery"),o.Message.GENERATE_TO_OBJECT&&(proto.impresso.query.DateRange.prototype.toObject=function(e){return proto.impresso.query.DateRange.toObject(e,this)},proto.impresso.query.DateRange.toObject=function(e,r){var t={from:o.Message.getFieldWithDefault(r,1,0),to:o.Message.getFieldWithDefault(r,2,0)};return e&&(t.$jspbMessageInstance=r),t}),proto.impresso.query.DateRange.deserializeBinary=function(e){var r=new o.BinaryReader(e),t=new proto.impresso.query.DateRange;return proto.impresso.query.DateRange.deserializeBinaryFromReader(t,r)},proto.impresso.query.DateRange.deserializeBinaryFromReader=function(e,r){for(;r.nextField()&&!r.isEndGroup();){switch(r.getFieldNumber()){case 1:var t=r.readSint64();e.setFrom(t);break;case 2:t=r.readSint64();e.setTo(t);break;default:r.skipField()}}return e},proto.impresso.query.DateRange.prototype.serializeBinary=function(){var e=new o.BinaryWriter;return proto.impresso.query.DateRange.serializeBinaryToWriter(this,e),e.getResultBuffer()},proto.impresso.query.DateRange.serializeBinaryToWriter=function(e,r){var t=void 0;0!==(t=e.getFrom())&&r.writeSint64(1,t),0!==(t=e.getTo())&&r.writeSint64(2,t)},proto.impresso.query.DateRange.prototype.getFrom=function(){return o.Message.getFieldWithDefault(this,1,0)},proto.impresso.query.DateRange.prototype.setFrom=function(e){return o.Message.setProto3IntField(this,1,e)},proto.impresso.query.DateRange.prototype.getTo=function(){return o.Message.getFieldWithDefault(this,2,0)},proto.impresso.query.DateRange.prototype.setTo=function(e){return o.Message.setProto3IntField(this,2,e)},proto.impresso.query.Filter.repeatedFields_=[5,7],o.Message.GENERATE_TO_OBJECT&&(proto.impresso.query.Filter.prototype.toObject=function(e){return proto.impresso.query.Filter.toObject(e,this)},proto.impresso.query.Filter.toObject=function(e,r){var t,i={context:o.Message.getFieldWithDefault(r,1,0),op:o.Message.getFieldWithDefault(r,2,0),type:o.Message.getFieldWithDefault(r,3,0),precision:o.Message.getFieldWithDefault(r,4,0),qList:null==(t=o.Message.getRepeatedField(r,5))?void 0:t,daterange:(t=r.getDaterange())&&proto.impresso.query.DateRange.toObject(e,t),uidsList:null==(t=o.Message.getRepeatedField(r,7))?void 0:t};return e&&(i.$jspbMessageInstance=r),i}),proto.impresso.query.Filter.deserializeBinary=function(e){var r=new o.BinaryReader(e),t=new proto.impresso.query.Filter;return proto.impresso.query.Filter.deserializeBinaryFromReader(t,r)},proto.impresso.query.Filter.deserializeBinaryFromReader=function(e,r){for(;r.nextField()&&!r.isEndGroup();){switch(r.getFieldNumber()){case 1:var t=r.readEnum();e.setContext(t);break;case 2:t=r.readEnum();e.setOp(t);break;case 3:t=r.readEnum();e.setType(t);break;case 4:t=r.readEnum();e.setPrecision(t);break;case 5:t=r.readString();e.addQ(t);break;case 6:t=new proto.impresso.query.DateRange;r.readMessage(t,proto.impresso.query.DateRange.deserializeBinaryFromReader),e.setDaterange(t);break;case 7:t=r.readString();e.addUids(t);break;default:r.skipField()}}return e},proto.impresso.query.Filter.prototype.serializeBinary=function(){var e=new o.BinaryWriter;return proto.impresso.query.Filter.serializeBinaryToWriter(this,e),e.getResultBuffer()},proto.impresso.query.Filter.serializeBinaryToWriter=function(e,r){var t=void 0;0!==(t=e.getContext())&&r.writeEnum(1,t),0!==(t=e.getOp())&&r.writeEnum(2,t),0!==(t=e.getType())&&r.writeEnum(3,t),0!==(t=e.getPrecision())&&r.writeEnum(4,t),(t=e.getQList()).length>0&&r.writeRepeatedString(5,t),null!=(t=e.getDaterange())&&r.writeMessage(6,t,proto.impresso.query.DateRange.serializeBinaryToWriter),(t=e.getUidsList()).length>0&&r.writeRepeatedString(7,t)},proto.impresso.query.Filter.prototype.getContext=function(){return o.Message.getFieldWithDefault(this,1,0)},proto.impresso.query.Filter.prototype.setContext=function(e){return o.Message.setProto3EnumField(this,1,e)},proto.impresso.query.Filter.prototype.getOp=function(){return o.Message.getFieldWithDefault(this,2,0)},proto.impresso.query.Filter.prototype.setOp=function(e){return o.Message.setProto3EnumField(this,2,e)},proto.impresso.query.Filter.prototype.getType=function(){return o.Message.getFieldWithDefault(this,3,0)},proto.impresso.query.Filter.prototype.setType=function(e){return o.Message.setProto3EnumField(this,3,e)},proto.impresso.query.Filter.prototype.getPrecision=function(){return o.Message.getFieldWithDefault(this,4,0)},proto.impresso.query.Filter.prototype.setPrecision=function(e){return o.Message.setProto3EnumField(this,4,e)},proto.impresso.query.Filter.prototype.getQList=function(){return o.Message.getRepeatedField(this,5)},proto.impresso.query.Filter.prototype.setQList=function(e){return o.Message.setField(this,5,e||[])},proto.impresso.query.Filter.prototype.addQ=function(e,r){return o.Message.addToRepeatedField(this,5,e,r)},proto.impresso.query.Filter.prototype.clearQList=function(){return this.setQList([])},proto.impresso.query.Filter.prototype.getDaterange=function(){return o.Message.getWrapperField(this,proto.impresso.query.DateRange,6)},proto.impresso.query.Filter.prototype.setDaterange=function(e){return o.Message.setWrapperField(this,6,e)},proto.impresso.query.Filter.prototype.clearDaterange=function(){return this.setDaterange(void 0)},proto.impresso.query.Filter.prototype.hasDaterange=function(){return null!=o.Message.getField(this,6)},proto.impresso.query.Filter.prototype.getUidsList=function(){return o.Message.getRepeatedField(this,7)},proto.impresso.query.Filter.prototype.setUidsList=function(e){return o.Message.setField(this,7,e||[])},proto.impresso.query.Filter.prototype.addUids=function(e,r){return o.Message.addToRepeatedField(this,7,e,r)},proto.impresso.query.Filter.prototype.clearUidsList=function(){return this.setUidsList([])},proto.impresso.query.SearchQuery.repeatedFields_=[1],o.Message.GENERATE_TO_OBJECT&&(proto.impresso.query.SearchQuery.prototype.toObject=function(e){return proto.impresso.query.SearchQuery.toObject(e,this)},proto.impresso.query.SearchQuery.toObject=function(e,r){var t={filtersList:o.Message.toObjectList(r.getFiltersList(),proto.impresso.query.Filter.toObject,e),groupBy:o.Message.getFieldWithDefault(r,2,0)};return e&&(t.$jspbMessageInstance=r),t}),proto.impresso.query.SearchQuery.deserializeBinary=function(e){var r=new o.BinaryReader(e),t=new proto.impresso.query.SearchQuery;return proto.impresso.query.SearchQuery.deserializeBinaryFromReader(t,r)},proto.impresso.query.SearchQuery.deserializeBinaryFromReader=function(e,r){for(;r.nextField()&&!r.isEndGroup();){switch(r.getFieldNumber()){case 1:var t=new proto.impresso.query.Filter;r.readMessage(t,proto.impresso.query.Filter.deserializeBinaryFromReader),e.addFilters(t);break;case 2:t=r.readEnum();e.setGroupBy(t);break;default:r.skipField()}}return e},proto.impresso.query.SearchQuery.prototype.serializeBinary=function(){var e=new o.BinaryWriter;return proto.impresso.query.SearchQuery.serializeBinaryToWriter(this,e),e.getResultBuffer()},proto.impresso.query.SearchQuery.serializeBinaryToWriter=function(e,r){var t=void 0;(t=e.getFiltersList()).length>0&&r.writeRepeatedMessage(1,t,proto.impresso.query.Filter.serializeBinaryToWriter),0!==(t=e.getGroupBy())&&r.writeEnum(2,t)},proto.impresso.query.SearchQuery.prototype.getFiltersList=function(){return o.Message.getRepeatedWrapperField(this,proto.impresso.query.Filter,1)},proto.impresso.query.SearchQuery.prototype.setFiltersList=function(e){return o.Message.setRepeatedWrapperField(this,1,e)},proto.impresso.query.SearchQuery.prototype.addFilters=function(e,r){return o.Message.addToRepeatedWrapperField(this,1,e,proto.impresso.query.Filter,r)},proto.impresso.query.SearchQuery.prototype.clearFiltersList=function(){return this.setFiltersList([])},proto.impresso.query.SearchQuery.prototype.getGroupBy=function(){return o.Message.getFieldWithDefault(this,2,0)},proto.impresso.query.SearchQuery.prototype.setGroupBy=function(e){return o.Message.setProto3EnumField(this,2,e)},proto.impresso.query.FilterContext={CONTEXT_UNSPECIFIED:0,CONTEXT_INCLUDE:1,CONTEXT_EXCLUDE:2},proto.impresso.query.FilterOperator={OPERATOR_UNSPECIFIED:0,OPERATOR_AND:1,OPERATOR_OR:2},proto.impresso.query.FilterType={TYPE_UNSPECIFIED:0,TYPE_UID:1,TYPE_HAS_TEXT_CONTENTS:2,TYPE_TITLE:3,TYPE_IS_FRONT:4,TYPE_PAGE:5,TYPE_ISSUE:6,TYPE_STRING:7,TYPE_ENTITY:8,TYPE_NEWSPAPER:9,TYPE_DATERANGE:10,TYPE_YEAR:11,TYPE_LANGUAGE:12,TYPE_TYPE:13,TYPE_REGEX:14,TYPE_MENTION:15,TYPE_PERSON:16,TYPE_LOCATION:17,TYPE_TOPIC:18,TYPE_COLLECTION:19,TYPE_OCR_QUALITY:20,TYPE_CONTENT_LENGTH:21,TYPE_COUNTRY:22,TYPE_ACCESS_RIGHT:23,TYPE_PARTNER:24,TYPE_MONTH:25,TYPE_TEXT_REUSE_CLUSTER_SIZE:26,TYPE_TEXT_REUSE_CLUSTER_LEXICAL_OVERLAP:27,TYPE_TEXT_REUSE_CLUSTER_DAY_DELTA:28},proto.impresso.query.FilterPrecision={PRECISION_UNSPECIFIED:0,PRECISION_EXACT:1,PRECISION_PARTIAL:2,PRECISION_FUZZY:3,PRECISION_SOFT:4},proto.impresso.query.GroupValue={GROUPVALUE_UNSPECIFIED:0,GROUPVALUE_ARTICLES:1},t.object.extend(r,proto.impresso.query)})),R=E,P=F,_=h,S=T,D=q,v=O,j=b.Filter,M=b.FilterContext,I=b.FilterOperator,w=b.FilterType,C=b.FilterPrecision,B=b.DateRange,N=b.SearchQuery,A=b.GroupValue;function L(e){if(void 0!==e)return{from:Date.parse(e.from),to:Date.parse(e.to)}}function U(e){if(void 0!==e)return{from:new Date(e.from).toISOString(),to:new Date(e.to).toISOString()}}function x(e){return n({},e,{q:(r=e.q,"string"==typeof r||r instanceof String?[r]:r),context:S(M,e.context),op:S(I,e.op),type:S(w,e.type),precision:S(C,e.precision),daterange:R(B,L(e.daterange))});var r}function Y(e){return P(n({},e,{q:(r=e.q,void 0!==r&&1===r.length?r[0]:r),context:_(M,e.context),op:_(I,e.op,!0),type:_(w,e.type),precision:_(C,e.precision),daterange:U(e.daterange)}));var r}function z(e){return n({},e,{filters:(e.filters||[]).map((function(e){return R(j,x(e))})),groupBy:S(A,e.groupBy)})}function Q(e){return P(n({},e,{filters:(e.filters||[]).map(Y),groupBy:_(A,e.groupBy)}))}var W={filter:{serialize:function(e){return D(j,e,x)},deserialize:function(e){return v(j,e,Y)}},searchQuery:{serialize:function(e){return D(N,e,z)},deserialize:function(e){return v(N,e,Q)}}},k=r.camel,G=b.FilterType,X=b.FilterOperator,V=b.FilterContext,H=b.FilterPrecision,$=Object.freeze(Object.keys(G).filter((function(e){return G[e]!==G.TYPE_UNSPECIFIED})).map((function(e){return k(e.split("_").slice(1).join("_"))}))),J=Object.freeze(Object.keys(X).filter((function(e){return X[e]!==X.OPERATOR_UNSPECIFIED})).map((function(e){return k(e.split("_").slice(1).join("_")).toUpperCase()}))),Z=Object.freeze(Object.keys(V).filter((function(e){return V[e]!==V.CONTEXT_UNSPECIFIED})).map((function(e){return k(e.split("_").slice(1).join("_")).toLowerCase()}))),K=Object.freeze(Object.keys(H).filter((function(e){return H[e]!==H.PRECISION_UNSPECIFIED})).map((function(e){return k(e.split("_").slice(1).join("_")).toLowerCase()})));function ee(e){return u(e.reduce((function(e,r){var t,o,i,s,n,a,u,p,l=(o=(t=r).type,i=t.op,s=void 0===i?"OR":i,n=t.context,a=void 0===n?"inclusive":n,u=t.precision,p=void 0===u?"exact":u,"t:".concat(o,"-o:").concat(s,"-c:").concat(a,"-p:").concat(p)),c=e.get(l)||[];return e.set(l,c.concat([r])),e}),new Map).entries()).map((function(e){var r,t,o=a(e,2)[1],i=o[0],s=i.type,n=i.context,u=i.precision,p=i.op,l=o.flatMap((function(e){var r=e.q;return Array.isArray(r)?r:[r]})).filter((function(e){return null!=e}));return r={type:s,context:n,precision:u,op:p,q:l.length>1?l:l[0]},t=function(e){return null==e},Object.keys(r).reduce((function(e,o){var i=r[o];return t(i)||(e[o]=i),e}),{})}))}var re={protobuf:W,constants:{filter:{Types:$,Operators:J,Contexts:Z,Precision:K}},logic:{filter:{optimizeFilters:ee,mergeFilters:function(e){return ee(e.flat().map((function(e){return n({},e,{op:Array.isArray(e.q)&&1===e.q.length||!Array.isArray(e.q)?"AND":e.op})})))}}}},te=re.protobuf,oe=re.constants,ie=re.logic;e.constants=oe,e.default=re,e.logic=ie,e.protobuf=te,Object.defineProperty(e,"__esModule",{value:!0})}));